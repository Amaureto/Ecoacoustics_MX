---
title: "RecordingDistance_LinearModel"
author: "Amauri"
date: "5 de abril de 2019"
output:
  pdf_document:
    df_print: kable #enhance the default display of data frames
    number_sections: yes
    latex_engine: xelatex #available engines to render PDFs: 'pdflatex', 'xelatex', and 'lualatex' 
  word_document: default
  html_document:
    highlight: tango #specifies the syntax highlighting style
    df_print: paged #tables are printed as HTML tables
    toc: true #add table of contents
    toc_float: true #float the table of contents to the left 
bibliography: "C:/Users/Amaureto/OneDrive - El Instituto de Ecología/ASR_PhD_Thesis/ASR_PhD_library.bib" #specify a bibliography file
biblio-style: apalike-es #set the bibliography style to use
citation_package: natbib #when the output is LaTeX/PDF use "natbib" to generate citations
fig_caption: yes #figures rendered with captions
fontsize: 12 
header-includes:
  - \usepackage[spanish]{babel} #lenguaje de compilación del documento: "español"
---

***

Nota 1: Esta es una sección del artículo en preparación titulado: **Evaluación del rango de alcance de una grabadora automatizada en el bosque de niebla**

Nota 2: Los archivos de datos y tablas (.csv), referencias bibliográficas (.bib) e imágenes (.jpg) que se llaman desde este script están en la carpeta compartida desde mi OneDrive 365  "Ecoacoustics_MX_files/RDistance_Experiment"

***

# OBJETIVO PARTICULAR
Analizamos el efecto de la distancia, de la pendiente del terreno, y de la densidad de vegetación arbórea sobre la pérdida de las señales. Dado que la amplitud de los sonidos disminuye con la distancia y con obstáculos, esperamos que las señales de alta frecuencia se antenúen en distancias más próximas, y que a mayor cobertura de vegetación y pendiente del terreno se favorezca esta pérdida de amplitud.


# MÉTODOS

## Especies y sonidos utilizados para el experimento
Los sonidos elegidos pertenecen a diez animales vertebrados (tres anfibios, un reptil, cinco aves y un mamífero) que contrastan en su frecuencia de mayor energía (dominante). Estos audios se reprodujeron en en cada sitio o transecto a seis distancias (5, 20, 40, 60, 80 y 200 m) del micrófono evaluado. En los audios originales, se tomó nota de su frecuencia dominante (Hz) y su amplitud de referencia (*iref*), medida en dB a una distancia de referencia de 1m (*dref*); siendo estos los parámetros base para comparar con los datos resultantes del análisis de los audios regrabados por el dispositivo *SWIFT*. Además, para tomar en cuenta la complejidad espectro-temporal del sonido, se estimó el índice de diversidad acústica, que mide la entropía de la señal midiendo la actividad acústica en bandas de 500 Hz [@Villanuevaetal2011]. Esta variable se calculó usando "soundecology", una librería de R diseñada para análisis acústicos [@Villanueva2015] (Cuadro\ref{tab:tab1_sounds_10spp}).

```{r load_tablespecies, echo=FALSE, results='hide'}
tAudios_10spp <- read.csv("Audios_10Especies.csv", header=TRUE, sep=",")
tAudios_10spp
```


```{r tab1_sounds_10spp, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
library(kableExtra)
library(magrittr)
library(tidyverse)
library(dplyr)
library(purrr)

knitr::kable(tAudios_10spp, "latex", digits=2, booktabs=TRUE, caption="Lista de especies y caracterización acústica de los sonidos evaluados.\\label{tab:tab1_sounds_10spp}", align = c("c", "l", "l", "l", "l", "c", "c", "r", "r", "c", "c")) %>% 
#format="pandoc"
kable_styling(font_size = 8, latex_options = "scale_down") %>%
#column_spec(2, border_left = T, bold = TRUE) %>%
column_spec(4, italic = TRUE) %>%
column_spec(2, border_left = T) %>%
kableExtra::landscape() #tabla apaisada en una página horizontal
```


## *Caracterización del sitio*
Se eligieron *a priori* seis transectos (sitios) con diferente densidad de árboles, forma fisiográfica y pendiente del terreno; uno de estos (sitio 6) usado como control al presentar baja inclinación (<10°) y escasa densidad de árboles, ubicado en el Jardín Botánico Clavijero. Para estimar la densidad de la vegetación arbórea en el transecto, en cada punto de prueba se trazó una parcela circular de 5m de radio y dentro de esta área (78.5 m^2^) se contabilizó el número de árboles con DAP>10cm. Asimismo, se tomaron fotografías de la vegetación circundante (cuatro imágenes) y del dosel (una imagen). El porcentaje de cobertura del dosel se estimó en el programa *ImageJ*. Finalmente, se estimó la pendiente promedio del terreno (°) usando un hipsómetro láser *Nikon Forestry Pro*. Esta variable topográfica se registró apuntando a una distancia de 15m desde el punto del altavoz hacia los cuatro puntos cardinales. Este proceso se repitió en los seis puntos de cada transecto (Figura\ref{fig:fig2_RD_studyarea}).

```{r fig2_RD_studyarea, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', fig.pos='H', fig.height=4, out.width="98%", fig.cap="Área de estudio y diseño experimental indicando la ubicación de los seis sitios o transectos, las fotografías representativas de la vegetación, así como las formas fisiográficas de acuerdo al perfil de terreno.\\label{fig:fig2_RD_studyarea}"}
par(mar=c(2,2,1,1))
knitr::include_graphics("RD_studyarea.jpg")
```

**Base de datos**


```{r database, echo=TRUE}
#Cargamos datos
Datos_RD <- read.csv("Datos_RD.csv", header=TRUE, sep=",")
head(Datos_RD, 8)
```


# RESULTADOS

## *Efecto de la topografía y la vegetación*

**Modelo lineal**

Para cada una de las especies, se realizó un **modelo lineal** de la **amplitud observada** en escala completa (dBFS) obtenida **para cada especie** en función de la **amplitud esperada** (dbFS), de la **distancia** de grabación (m), de la **pendiente** del sitio (°), de la **densidad de árboles** y de la **cobertura del dosel** (%).

Se utilizó la función "glmulti" para encontrar el modelo más apropiado con base en el Criterio corregido de Información de Akaike (AICc) según la especie de interés (Cuadro\ref{tab:tab2_BestModels}).



```{r bestmodel_selection, echo=TRUE, message=FALSE, warning=FALSE}

#Fui sustituyendo el valor de Especie uno por uno desde Sp1 hasta Sp10
library(glmulti)
glmulti.lm.rd <-
    glmulti(Amplitud_obs ~ offset(Amplitud_esp) + (Distancia + Cob_Dosel + Dens_arboles + Pendiente), data=subset(Datos_RD, Especie=="Sp1"),
            level = 2,               # indicate if consider interaction
            method = "h",            # Exhaustive approach
            crit = "aicc",            # AIC as criteria
            confsetsize = 1,         # Keep 1 best models
            plotty = F, report = F,  # No plot or interim reports
            fitfunction = "lm")      # lm function

## Show 5 best models (Use @ instead of $ for an S4 object)

#glmulti.lm.rd

#fórmula
glmulti.lm.rd@formulas[[1]]

#conocer los componentes del objeto
ls(glmulti.lm.rd@objects[[1]])

#conocer los componentes del summary del objeto
ls(summary(glmulti.lm.rd@objects[[1]]))

#coeficientes 
summary(glmulti.lm.rd@objects[[1]])$coefficients

#Valores de significancia por variable
#format(signif(summary(glmulti.lm.rd@objects[[1]])$coefficients[2,4], digits = 3))
#format(signif(summary(glmulti.lm.rd@objects[[1]])$coefficients[3,4], digits = 3))
#format(signif(summary(glmulti.lm.rd@objects[[1]])$coefficients[4,4], digits = 3))

#Valor de r^2
round(summary(glmulti.lm.rd@objects[[1]])$r.squared, digits=2)

#Valor de AICc
aicc(glmulti.lm.rd@objects[[1]])

#Valor de p del test Shapiro-Wilk
shapiro.test(residuals.lm(glmulti.lm.rd@objects[[1]]))

#ANOVA
anova(glmulti.lm.rd@objects[[1]])

#De esta manera se pueden llamar los objetos del Summary de los Modelos.

```







```{r load_tablebestmodels, echo=FALSE, results='hide'}
#Se carga la tabla con los resultados de los modelos, la cual se construyó copiando datos uno por uno a Excel. 
ResultsModels <- read.csv("RD_BestModels.csv", header=TRUE, sep=",")
ResultsModels
```



```{r tab2_BestModels, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
library(kableExtra)
library(magrittr)
library(tidyverse)
library(dplyr)
library(purrr)

knitr::kable(ResultsModels, "latex", digits=2, booktabs=TRUE, caption="Resultados de los modelos lineales .\\label{tab:tab2_BestModels}", align = c("c", "l", "r", "l", "c", "c", "c", "c", "c", "c", "c")) %>% 
#format="pandoc"
kable_styling(font_size = 8, latex_options = "scale_down") %>%
#column_spec(2, border_left = T, bold = TRUE) %>%
column_spec(4, italic = TRUE) %>%
column_spec(2, border_left = T) %>%
column_spec(7, bold = T) %>%
kableExtra::landscape() #tabla apaisada en una página horizontal
```

# BIBLIOGRAFÍA


